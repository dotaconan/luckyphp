define(["jquery"],function(e){var t=e(window),n=!1,r=[],i=[],s={timeout:10,buffer:100,loadingClass:"lazy-loading",srcValue:"lazy-src",bgValue:"lazy-bg"},o,u,a={_init:function(){o=this},listen:function(t,u,a){var f=e(t||"img["+s.srcValue+"]"),l=u||"img",c;a&&(c=i.push(a)-1),f.each(function(){var t=e(this);r.push({type:l,obj:t,callback:a?i[c]:null}),t.addClass(s.loadingClass)}),n||o._startListen(),o.detect()},_startListen:function(){t.bind("scroll.lazyelem resize.lazyelem",function(){if(!r.length)return;clearTimeout(u),u=setTimeout(function(){o.detect()},s.timeout)}),n=!0},detect:function(){for(var e=0;e<r.length;e++){var i=r[e],u=i.obj;if(u.is(":hidden")||!o._isTrigger(u))continue;switch(i.type){case"fn":break;case"img":var a=u.attr(s.srcValue);a&&u.attr("src",a).removeAttr(s.srcValue);break;case"bg":var f=u.attr(s.bgValue);f&&u.css("background-image","url("+f+")").removeAttr(s.bgValue);break;case"dom":var l=u.children("script");l.length&&l.replaceWith(o._minHtml(l.html()))}i.callback&&i.callback(u),u.removeClass(s.loadingClass),r.splice(e--,1)}r.length===0&&(t.unbind("scroll.lazyelem resize.lazyelem"),n=!1)},_isTrigger:function(e){var n=t.height(),r=t.scrollTop(),i=e.height(),o=e.offset().top;return o+i>r-s.buffer&&o<r+n+s.buffer},_minHtml:function(e){var t=/\n+/g,n=/<!--.*?-->/ig,r=/\/\*.*?\*\//ig,i=/[ ]+</ig;return e=e.replace(t,""),e=e.replace(n,""),e=e.replace(r,""),e=e.replace(i,"<"),e},config:function(t){e.extend(s,t)}};return a._init(),a});